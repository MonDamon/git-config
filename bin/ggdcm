#!/bin/sh

# git diff check multiple

me=`basename $0`

if [ "$#" -ne 1 ]; then
    echo "Usage: $me [commit range]" >&2
    exit 1
fi

found_errors=0

gglh --reverse "$1" | while read sha1; do
  if ggdc $sha1^ $sha1 >/dev/null; then
    echo "$sha1 has no whitespace errors"
    continue
  fi

  : $(( found_errors++ ))

  (
    git --no-pager log -n1 --color $sha1
    echo
    echo ggdc --color $sha1^ $sha1
    ggdc --color $sha1^ $sha1
  ) | less
  echo ----------------------------------------------------------------------
done

exit $found_errors
